/**
 *
 *   _____ _    _          __  __ ______ _      ______ ____  _   _
 *  / ____| |  | |   /\   |  \/  |  ____| |    |  ____/ __ \| \ | |
 * | |    | |__| |  /  \  | \  / | |__  | |    | |__ | |  | |  \| |
 * | |    |  __  | / /\ \ | |\/| |  __| | |    |  __|| |  | | . ` |
 * | |____| |  | |/ ____ \| |  | | |____| |____| |___| |__| | |\  |
 *  \_____|_|  |_/_/    \_\_|  |_|______|______|______\____/|_| \_|
 *
 *
 * chameleon.js - A jQuery plugin to synchronize slide images with videos in JWPlayer 7, HTML5 or YouTube Player
 * @author WONG, Wing Kam - wingkwong.code@gmail.com
 * @version - 1.3.0
 */

!function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery"],e):"undefined"!=typeof exports?module.exports=e(require("jquery")):e(jQuery)}(function(e){var n="chameleon";function t(t,i){e(t);i=e.extend({},e.fn[n].defaults,i);var o=e(".chameleon"),a=e(this),d='<div class="header-container"></div>',l='<div class="video-container"></div>',s='<div class="slide-container"><img/></div>',r='<div class="info-panel"></div>',c='<div class="carousel-container"></div>',h='<div class="download-container"></div>',f='<div class="preview-slide-container"></div>',p='<div class="carousel-item"></div>',m='<div class="thumbnail-container"><div class="slide-image"><img/></div><div class="slide-number"></div></div>',u='<a class="carousel-control prev"></a><a class="carousel-control next"></a>',v='<span class="download-icon"></span>',w={base:'<div id="jwplayer" class="chameleon-jwplayer-video"></div>'},x={base:'<video id="chameleon-html5-video" class="chameleon-html5-video" controls preload="auto" width="100%" height="100%"/>',source:"<source/>"},C={base:'<div id="chameleon-youtube-video" class="chameleon-youtube-video" width="100%" height="100%" frameborder="0" allowfullscreen></div>'},g={base:'<div class="dropdown-box"></div>',header:'<div class="dropdown-header"></div>',button:'<div class="dropdown-btn-wrapper">Markers <span class="dropdown-btn up"></span></div>',content:'<div class="dropdown-content"></div>'},b={base:'<a href="javascript:;" class="info-panel-slide"></a>',slideThumbnail:'<div class="slide-thumbnail"><img/></div>',slideNumber:'<div class="slide-number"></div>',slideTitle:'<div class="slide-title-wrapper"><div class="slide-title"></div></div>',slideTime:'<div class="slide-time"></div>'};function y(){if("jwplayer"==i.player&&void 0===a.chameleonContext.jwplayerSetup)throw new Error("JWPlayer setup object hasn't been defined in chameleonContext.");if("html5"==i.player&&void 0===a.chameleonContext.html5Setup)throw new Error("HTML5 Player setup object hasn't been defined in chameleonContext.");if("youtube"==i.player&&void 0===a.chameleonContext.youtubeSetup)throw new Error("YouTube Player setup object hasn't been defined in chameleonContext.");if(void 0===a.chameleonContext.slides||"object"!=typeof a.chameleonContext.slides)throw new Error("slides hasn't been defined in chameleonContext.");if(0==a.chameleonContext.slides.length)throw new Error("No slide hasn't been defined in chameleonContext.");!function(){if(function(){switch(i.player){case"jwplayer":o.find(".video-container").append(w.base),a.jwPlayerInst=jwplayer("jwplayer").setup(a.chameleonContext.jwplayerSetup),a.jwPlayerInst.onTime(function(){var e=a.jwPlayerInst.getPosition();$(e)}),a.jwPlayerInst.onComplete(function(){I(0),S(0)});break;case"html5":o.find(".video-container").append(x.base),function(){var n=a.chameleonContext.html5Setup,t=o.find(".chameleon-html5-video");if(e.isArray(n.sources))for(var i=0;i<n.sources.length;i++)$html5Source=e(x.source),$html5Source.attr({src:n.sources[i].file,type:n.sources[i].type}),t.append($html5Source);else $html5Source=e(x.source),$html5Source.attr({src:n.sources.file,type:n.sources.type}),t.append($html5Source);null!=n.poster&&""!=n.poster&&t.attr("poster",n.poster),t.bind("timeupdate",function(){var n=e(this).get(0).currentTime;$(n)}),t.bind("ended",function(){I(0),S(0)})}();break;case"youtube":o.find(".video-container").append(C.base),function(){o.find(".chameleon-youtube-video");var n=a.chameleonContext.youtubeSetup;e.getScript("//www.youtube.com/iframe_api").fail(function(e,n,t){console.log(t)}).done(function(){window.onYouTubeIframeAPIReady=function(){a.ytPlayer=new YT.Player("chameleon-youtube-video",{height:"100%",width:"100%",videoId:n.videoId,events:{onReady:function(){setInterval(function(){$(a.ytPlayer.getCurrentTime())},1e3)}}})}})}();break;default:throw new Error(i.player+" is not supported")}}(),I(0),i.showCarousel){o.append(c),o.find(".carousel-container").append(f).append(u);for(var n=1;n<=a.chameleonContext.slides.length;n++){var t=e(p).append(m);t.find(".slide-image").attr("data-index",n),t.find(".slide-image img").attr("src",a.chameleonContext.slides[n-1].img),t.find(".slide-image img").attr("title",a.chameleonContext.slides[n-1].title),t.find(".slide-image img").attr("alt",a.chameleonContext.slides[n-1].alt),t.find(".slide-number").html(n+"/"+a.chameleonContext.slides.length),o.find(".preview-slide-container").append(t)}if(o.find(".carousel-item:first").addClass("active"),a.chameleonContext.slides.length>i.numOfCarouselSlide){o.find(".carousel-item").each(function(){for(var n=e(this),t=1;t<i.numOfCarouselSlide;t++)(n=n.next()).length||(n=e(this).siblings(":first")),n.children(":first-child").clone().addClass("js-chameleon-"+t).appendTo(e(this))});var d=o.find(".carousel-item.active").width(),l=o.find(".carousel-item.active .thumbnail-container:first").width();if(a.maxImgInARow=Math.floor(d/l),i.numOfCarouselSlide>a.maxImgInARow&&a.maxImgInARow>5)o.find(".carousel-item .js-chameleon-3").addClass("current-slide");else{var s=o.find(".carousel-item.active .thumbnail-container").length;if(Math.floor(s/2)>=1){var n=o.find(".carousel-item.active .thumbnail-container:nth-child( "+Math.floor(s/2)+") .slide-image").attr("data-index");o.find(".carousel-item .js-chameleon-"+n).addClass("current-slide")}else o.find(".carousel-control").remove(),o.find(".carousel-item .thumbnail-container").addClass("current-slide")}o.find(".current-slide img").css("width","120px"),S(0)}else o.find(".carousel-control").remove(),o.find(".carousel-item").addClass("active")}if(i.showMarkers&&i.responsive){o.append(r),r=o.find(".info-panel"),$infoPanel=e(g.base),$header=e(g.header).append(g.button),$content=e(g.content),$ip=$infoPanel.append($header).append($content),r.append($ip);for(var n=0;n<a.chameleonContext.slides.length;n++)$infoPanelSlide=e(b.base).append(b.slideNumber).append(b.slideThumbnail).append(b.slideTime).append(b.slideTitle),$infoPanelSlide.attr("data-index",n),$infoPanelSlide.find(".slide-number").html("#"+(n+1)),$infoPanelSlide.find(".slide-thumbnail img").attr("src",a.chameleonContext.slides[n].img),$infoPanelSlide.find(".slide-time").html(a.chameleonContext.slides[n].time),void 0===a.chameleonContext.slides[n].title||""==a.chameleonContext.slides[n].title?$infoPanelSlide.find(".slide-title").html("-"):$infoPanelSlide.find(".slide-title").html(a.chameleonContext.slides[n].title),o.find(".dropdown-content").append($infoPanelSlide)}o.find(".slide-image").click(function(){var n=e(this).attr("data-index");j(P(a.chameleonContext.slides[n-1].time))}),o.find(".carousel-control.prev").click(function(){var n=e(".active .current-slide .slide-image").attr("data-index");0==(n=parseInt(n)-1)&&(n=a.chameleonContext.slides.length),j(P(a.chameleonContext.slides[n-1].time))}),o.find(".carousel-control.next").click(function(){var e=o.find(".active .current-slide .slide-image").attr("data-index");e==a.chameleonContext.slides.length&&(e=0),j(P(a.chameleonContext.slides[e].time))}),o.find(".info-panel-slide").click(function(){var n=e(this),t=n.attr("data-index");j(P(a.chameleonContext.slides[t].time))}),o.find(".info-panel .dropdown-btn-wrapper").click(function(){var n=e(this).find(".dropdown-btn");n.hasClass("down")?(n.parent().parent().parent().find(".dropdown-content").slideDown(),n.removeClass("down").addClass("up")):(n.parent().parent().parent().find(".dropdown-content").slideUp(),n.removeClass("up").addClass("down"))}),i.responsive?(o.addClass("chameleon-responsive"),o.find(".video-container").addClass("col-md-5 col-xs-12"),o.find(".video-container").css({padding:"0px",height:"400px"}),o.find(".slide-container").addClass("col-md-7 col-xs-12"),o.find(".slide-container img").css({"margin-left":"auto","margin-right":"auto",padding:"0px"}),o.find(".header-container").addClass("col-xs-12"),o.find(".header-container .video-title").addClass("col-xs-6"),o.find(".header-container .download-container").addClass("col-xs-6"),o.find(".info-panel").addClass("col-xs-12"),o.find(".carousel-container").addClass("col-xs-12 hidden-xs"),o.find(".download-btn").css({margin:"10px 0px"}),o.find(".info-panel-slide").addClass("col-xs-12 col-sm-6 col-lg-4"),o.find(".info-panel-slide .slide-number").addClass("col-xs-12 col-md-1"),o.find(".info-panel-slide .slide-thumbnail").addClass("col-xs-12 col-sm-6 col-lg-4"),o.find(".info-panel-slide .slide-time").addClass("col-xs-2"),o.find(".info-panel-slide .slide-title-wrapper").addClass("col-xs-12 col-lg-6")):(o.find(".video-container").css({float:"left",width:"50%",height:"100%"}),o.find(".slide-container").css({width:"50%",height:"100%",float:"left"}),o.find(".download-container").css({width:"50%",height:"40px",float:"left","line-height":"40px"}),o.find(".video-title").css({width:"50%",float:"left"}),o.find(".info-panel .slide-number, .info-panel .slide-time").css({width:"8.33333333%",float:"left","text-align":"center"}),o.find(".info-panel .slide-title-wrapper").css({width:"83.33333333%",float:"left","text-align":"center"}),o.find(".info-panel .slide-title").css({"padding-left":"30px"}))}()}function j(e){switch(i.player){case"jwplayer":a.jwPlayerInst.seek(e);break;case"html5":var n=o.find(".chameleon-html5-video").get(0);n.currentTime=e,n.play();break;case"youtube":a.ytPlayer.seekTo(e);break;default:throw new Error(i.player+" is not supported")}}function S(n){n=parseInt(n)+1;var t=e('.current-slide .slide-image[data-index="'+n+'"]').parent().parent();e(".carousel-item.active").removeClass("active"),t.addClass("active")}function P(e){var n=e.split(":");return parseInt(60*n[0]*60)+parseInt(60*n[1])+parseInt(n[2])}function $(e){if(e>=P(a.chameleonContext.slides[a.chameleonContext.slides.length-1].time))a.chameleonContext.slides.length>i.numOfCarouselSlide&&S(a.chameleonContext.slides.length-1),I(a.chameleonContext.slides.length-1),k(a.chameleonContext.slides.length-1);else for(var n=0,t=1;n<a.chameleonContext.slides.length;n++,t++)e>=P(a.chameleonContext.slides[n].time)&&e<P(a.chameleonContext.slides[t].time)&&(a.chameleonContext.slides.length>i.numOfCarouselSlide&&(S(n),k(n)),I(n))}function I(e){o.find(".slide-container img").attr("src",a.chameleonContext.slides[e].img),o.find(".slide-container img").attr("title",a.chameleonContext.slides[e].title),o.find(".slide-container img").attr("alt",a.chameleonContext.slides[e].alt)}function k(e){o.find(".chameleon-hightlighted").removeClass("chameleon-hightlighted"),o.find(".info-panel-slide[data-index='"+e+"']").addClass("chameleon-hightlighted")}!function(){if(e.isEmptyObject(i.chameleonContext))throw new Error("Chameleon chameleonContext hasn't been defined.");if(!i.chameleonContext.title&&e.isEmptyObject($o.chameleonContext.download)||(o.append(d),i.chameleonContext.title&&(o.find(".header-container").append('<div class="video-title"></div>'),o.find(".video-title").html(i.chameleonContext.title)),i.showDownloadPanel&&!e.isEmptyObject(i.chameleonContext.download)&&(o.find(".header-container").append(h),void 0!==i.chameleonContext.download.slides&&"object"==typeof i.chameleonContext.download.slides&&(void 0!==i.chameleonContext.download.slides.url&&"string"==typeof i.chameleonContext.download.slides.url&&(o.find(".download-container").append('<a class="download-btn download-slides" target="_blank" download></a>'),o.find(".download-slides").attr("href",i.chameleonContext.download.slides.url)),o.find(".download-slides").length>0&&void 0!==i.chameleonContext.download.slides.title&&"string"==typeof i.chameleonContext.download.slides.title&&(o.find(".download-slides").prepend(v),o.find(".download-slides").attr("title",i.chameleonContext.download.slides.title))),void 0!==i.chameleonContext.download.video&&"object"==typeof i.chameleonContext.download.video&&(void 0!==i.chameleonContext.download.video.url&&"string"==typeof i.chameleonContext.download.video.url&&(o.find(".download-container").append('<a class="download-btn download-video" target="_blank" download></a>'),o.find(".download-video").attr("href",i.chameleonContext.download.video.url)),o.find(".download-video").length>0&&void 0!==i.chameleonContext.download.video.title&&"string"==typeof i.chameleonContext.download.video.title&&(o.find(".download-video").prepend(v),o.find(".download-video").attr("title",i.chameleonContext.download.video.title))),void 0!==i.chameleonContext.download.transcript&&"object"==typeof i.chameleonContext.download.transcript&&(void 0!==i.chameleonContext.download.transcript.url&&"string"==typeof i.chameleonContext.download.transcript.url&&(o.find(".download-container").append('<a class="download-btn download-transcript" target="_blank" download></a>'),o.find(".download-transcript").attr("href",i.chameleonContext.download.transcript.url)),o.find(".download-transcript").length>0&&void 0!==i.chameleonContext.download.transcript.title&&"string"==typeof i.chameleonContext.download.transcript.title&&(o.find(".download-transcript").prepend(v),o.find(".download-transcript").attr("title",i.chameleonContext.download.transcript.title))))),o.append(l),o.append(s),i.responsive||o.css("width",i.width).css("height",i.height),"object"==typeof i.chameleonContext&&(a.chameleonContext=i.chameleonContext,y()),"string"==typeof i.chameleonContext){if("json"!=/(?:\.([^.]+))?$/.exec(i.chameleonContext)[1])throw new Error("JSON file required.");e.getJSON(i.chameleonContext,function(e){a.chameleonContext=e}).done(function(){y()})}}()}e.fn[n]=function(i){if("string"==typeof arguments[0]){var o,a=arguments[0],d=Array.prototype.slice.call(arguments,1);return this.each(function(){if(!e.data(this,"plugin_"+n)||"function"!=typeof e.data(this,"plugin_"+n)[a])throw new Error("Method "+a+" does not exist on jQuery."+n);o=e.data(this,"plugin_"+n)[a].apply(this,d)}),void 0!==o?o:this}if("object"==typeof i||!i)return this.each(function(){e.data(this,"plugin_"+n)||e.data(this,"plugin_"+n,new t(this,i))})},e.fn[n].defaults={width:"968px",height:"270px",chameleonContext:{},numOfCarouselSlide:5,responsive:!1,player:"html5",showMarkers:!1,showCarousel:!1,showDownloadPanel:!1}});
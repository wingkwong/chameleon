/**
 *
 *   _____ _    _          __  __ ______ _      ______ ____  _   _
 *  / ____| |  | |   /\   |  \/  |  ____| |    |  ____/ __ \| \ | |
 * | |    | |__| |  /  \  | \  / | |__  | |    | |__ | |  | |  \| |
 * | |    |  __  | / /\ \ | |\/| |  __| | |    |  __|| |  | | . ` |
 * | |____| |  | |/ ____ \| |  | | |____| |____| |___| |__| | |\  |
 *  \_____|_|  |_/_/    \_\_|  |_|______|______|______\____/|_| \_|
 *
 *
 * chameleon.js - synchronizing slides with JWPlayer Video
 * @author Wing Kam Wong - wingkwong.code@gmail.com
 * @version - 1.2.0
 */

!function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery"],e):"undefined"!=typeof exports?module.exports=e(require("jquery")):e(jQuery)}(function($){var I="chameleon";function i(e,d){$(e);d=$.extend({},$.fn[I].defaults,d);var a=$(".chameleon"),l=$(this),n='<div class="video-container"></div>',t='<div class="slide-container"><img/></div>',s='<div class="info-panel"></div>',o='<div class="carousel-container"></div>',i='<div class="download-container"></div>',r='<div class="preview-slide-container"></div>',c='<div class="carousel-item"></div>',h='<div class="thumbnail-container"><div class="slide-image"><img/></div><div class="slide-number"></div></div>',f='<a class="carousel-control prev"></a><a class="carousel-control next"></a>',m='<span class="download-icon"></span>',p={base:'<div id="jwplayer" class="chameleon-jwplayer-video"></div>'},u={base:'<video id="chameleon-html5-video" class="chameleon-html5-video" controls preload="auto" width="100%" height="100%"/>',source:"<source/>"},w={base:'<div id="chameleon-youtube-video" class="chameleon-youtube-video" width="100%" height="100%" frameborder="0" allowfullscreen></div>'},v={base:'<div class="dropdown-box"></div>',header:'<div class="dropdown-header"></div>',button:'<div class="dropdown-btn-wrapper">Markers <span class="dropdown-btn down"></span></div>',content:'<div class="dropdown-content"></div>'},x={base:'<a href="javascript:;" class="info-panel-slide"></a>',slideNumber:'<div class="slide-number"></div>',slideTitle:'<div class="slide-title-wrapper"><div class="slide-title"></div></div>',slideTime:'<div class="slide-time"></div>'};function C(){if("jwplayer"==d.player&&void 0===l.chameleonContext.jwplayerSetup)throw new Error("JWPlayer setup object hasn't been defined in chameleonContext.");if("html5"==d.player&&void 0===l.chameleonContext.html5Setup)throw new Error("HTML5 Player setup object hasn't been defined in chameleonContext.");if("youtube"==d.player&&void 0===l.chameleonContext.youtubeSetup)throw new Error("YouTube Player setup object hasn't been defined in chameleonContext.");if(void 0===l.chameleonContext.slides||"object"!=typeof l.chameleonContext.slides)throw new Error("slides hasn't been defined in chameleonContext.");if(0==l.chameleonContext.slides.length)throw new Error("No slide hasn't been defined in chameleonContext.");!function(){(function(){switch(d.player){case"jwplayer":a.find(".video-container").append(p.base),l.jwPlayerInst=jwplayer("jwplayer").setup(l.chameleonContext.jwplayerSetup),l.jwPlayerInst.onTime(function(){var e=l.jwPlayerInst.getPosition();j(e)}),l.jwPlayerInst.onComplete(function(){S(0),b(0)});break;case"html5":a.find(".video-container").append(u.base),function(){var e=l.chameleonContext.html5Setup,n=a.find(".chameleon-html5-video");if($.isArray(e.sources))for(var t=0;t<e.sources.length;t++)$html5Source=$(u.source),$html5Source.attr({src:e.sources[t].file,type:e.sources[t].type}),n.append($html5Source);else $html5Source=$(u.source),$html5Source.attr({src:e.sources.file,type:e.sources.type}),n.append($html5Source);null!=e.poster&&""!=e.poster&&n.attr("poster",e.poster);n.bind("timeupdate",function(){var e=$(this).get(0).currentTime;j(e)}),n.bind("ended",function(){S(0),b(0)})}();break;case"youtube":a.find(".video-container").append(w.base),function(){a.find(".chameleon-youtube-video");var e=l.chameleonContext.youtubeSetup;$.getScript("//www.youtube.com/iframe_api").fail(function(e,n,t){console.log(t)}).done(function(){window.onYouTubeIframeAPIReady=function(){l.ytPlayer=new YT.Player("chameleon-youtube-video",{height:"100%",width:"100%",videoId:e.videoId,events:{onReady:function(){setInterval(function(){j(l.ytPlayer.getCurrentTime())},1e3)}}})}})}();break;default:throw new Error(d.player+" is not supported")}})(),S(0),a.find(".carousel-container").append(r).append(f);for(var e=1;e<=l.chameleonContext.slides.length;e++){var n=$(c).append(h);n.find(".slide-image").attr("data-index",e),n.find(".slide-image img").attr("src",l.chameleonContext.slides[e-1].img),n.find(".slide-image img").attr("title",l.chameleonContext.slides[e-1].title),n.find(".slide-image img").attr("alt",l.chameleonContext.slides[e-1].alt),n.find(".slide-number").html(e+"/"+l.chameleonContext.slides.length),a.find(".preview-slide-container").append(n)}if(a.find(".carousel-item:first").addClass("active"),l.chameleonContext.slides.length>d.numOfCarouselSlide){a.find(".carousel-item").each(function(){for(var e=$(this),n=1;n<d.numOfCarouselSlide;n++)(e=e.next()).length||(e=$(this).siblings(":first")),e.children(":first-child").clone().addClass("js-chameleon-"+n).appendTo($(this))});var t=a.find(".carousel-item.active").width(),o=a.find(".carousel-item.active .thumbnail-container:first").width();if(l.maxImgInARow=Math.floor(t/o),d.numOfCarouselSlide>l.maxImgInARow&&5<l.maxImgInARow)a.find(".carousel-item .js-chameleon-3").addClass("current-slide");else{var i=a.find(".carousel-item.active .thumbnail-container").length;if(1<=Math.floor(i/2)){var e=a.find(".carousel-item.active .thumbnail-container:nth-child( "+Math.floor(i/2)+") .slide-image").attr("data-index");a.find(".carousel-item .js-chameleon-"+e).addClass("current-slide")}else a.find(".carousel-control").remove(),a.find(".carousel-item .thumbnail-container").addClass("current-slide")}a.find(".current-slide img").css("width","120px"),b(0)}else a.find(".carousel-control").remove(),a.find(".carousel-item").addClass("active");$.isEmptyObject(l.chameleonContext.download)||(void 0===l.chameleonContext.download.slides&&void 0===l.chameleonContext.download.videos&&void 0===l.chameleonContext.download.transcript&&a.find(".download-container").remove(),void 0!==l.chameleonContext.download.slides&&"object"==typeof l.chameleonContext.download.slides&&(void 0!==l.chameleonContext.download.slides.url&&"string"==typeof l.chameleonContext.download.slides.url&&(a.find(".download-container").append('<a class="download-btn download-slides" target="_blank" download>Download slides</a>'),a.find(".download-slides").attr("href",l.chameleonContext.download.slides.url)),0<a.find(".download-slides").length&&void 0!==l.chameleonContext.download.slides.title&&"string"==typeof l.chameleonContext.download.slides.title&&(a.find(".download-slides").html(l.chameleonContext.download.slides.title),a.find(".download-slides").prepend(m),a.find(".download-slides").attr("title",l.chameleonContext.download.slides.title))),void 0!==l.chameleonContext.download.video&&"object"==typeof l.chameleonContext.download.video&&(void 0!==l.chameleonContext.download.video.url&&"string"==typeof l.chameleonContext.download.video.url&&(a.find(".download-container").append('<a class="download-btn download-video" target="_blank" download>Download video</a>'),a.find(".download-video").attr("href",l.chameleonContext.download.video.url)),0<a.find(".download-video").length&&void 0!==l.chameleonContext.download.video.title&&"string"==typeof l.chameleonContext.download.video.title&&(a.find(".download-video").html(l.chameleonContext.download.video.title),a.find(".download-video").prepend(m),a.find(".download-video").attr("title",l.chameleonContext.download.video.title))),void 0!==l.chameleonContext.download.transcript&&"object"==typeof l.chameleonContext.download.transcript&&(void 0!==l.chameleonContext.download.transcript.url&&"string"==typeof l.chameleonContext.download.transcript.url&&(a.find(".download-container").append('<a class="download-btn download-transcript" target="_blank" download>Download transcript</a>'),a.find(".download-transcript").attr("href",l.chameleonContext.download.transcript.url)),0<a.find(".download-transcript").length&&void 0!==l.chameleonContext.download.transcript.title&&"string"==typeof l.chameleonContext.download.transcript.title&&(a.find(".download-transcript").html(l.chameleonContext.download.transcript.title),a.find(".download-transcript").prepend(m),a.find(".download-transcript").attr("title",l.chameleonContext.download.transcript.title))));s=a.find(".info-panel"),$infoPanel=$(v.base),$header=$(v.header).append(v.button),$content=$(v.content),$ip=$infoPanel.append($header).append($content),s.append($ip);for(var e=0;e<l.chameleonContext.slides.length;e++)$infoPanelSlide=$(x.base).append(x.slideNumber).append(x.slideTime).append(x.slideTitle),$infoPanelSlide.attr("data-index",e),$infoPanelSlide.find(".slide-number").html("#"+(e+1)),$infoPanelSlide.find(".slide-time").html(l.chameleonContext.slides[e].time),void 0===l.chameleonContext.slides[e].title||""==l.chameleonContext.slides[e].title?$infoPanelSlide.find(".slide-title").html("-"):$infoPanelSlide.find(".slide-title").html(l.chameleonContext.slides[e].title),a.find(".dropdown-content").append($infoPanelSlide);a.find(".slide-image").click(function(){var e=$(this).attr("data-index");g(y(l.chameleonContext.slides[e-1].time))}),a.find(".carousel-control.prev").click(function(){var e=$(".active .current-slide .slide-image").attr("data-index");0==(e=parseInt(e)-1)&&(e=l.chameleonContext.slides.length),g(y(l.chameleonContext.slides[e-1].time))}),a.find(".carousel-control.next").click(function(){var e=a.find(".active .current-slide .slide-image").attr("data-index");e==l.chameleonContext.slides.length&&(e=0),g(y(l.chameleonContext.slides[e].time))}),a.find(".info-panel-slide").click(function(){var e=$(this),n=e.attr("data-index");g(y(l.chameleonContext.slides[n].time))}),a.find(".info-panel .dropdown-btn-wrapper").click(function(){var e=$(this).find(".dropdown-btn");e.hasClass("down")?(e.parent().parent().parent().find(".dropdown-content").slideDown(),e.removeClass("down").addClass("up")):(e.parent().parent().parent().find(".dropdown-content").slideUp(),e.removeClass("up").addClass("down"))}),d.responsive?(a.find(".video-container").addClass("col-md-6 col-xs-12"),a.find(".video-container").css({padding:"0px",height:"300px"}),a.find(".slide-container").addClass("col-md-6 col-xs-12"),a.find(".slide-container img").css({"margin-left":"auto","margin-right":"auto",padding:"0px"}),a.find(".info-panel").addClass("col-xs-12"),a.find(".carousel-container").addClass("col-xs-12 hidden-xs"),a.find(".download-container").addClass("col-xs-12"),a.find(".download-btn").addClass("col-xs-12 col-sm-4"),a.find(".download-btn").css({margin:"10px 0px"}),a.find(".info-panel-slide .slide-number").addClass("col-xs-12 col-sm-2"),a.find(".info-panel-slide .slide-time").addClass("col-xs-12 col-sm-2"),a.find(".info-panel-slide .slide-title-wrapper").addClass("col-xs-12 col-sm-8")):(a.find(".video-container").css({float:"left",width:"50%",height:"100%"}),a.find(".slide-container").css({width:"50%",height:"100%",float:"left"}),a.find(".download-container").css({width:"100%",height:"40px",float:"left","line-height":"40px"}),a.find(".download-btn").css({width:"30%"}),a.find(".info-panel .slide-number, .info-panel .slide-time").css({width:"8.33333333%",float:"left","text-align":"center"}),a.find(".info-panel .slide-title-wrapper").css({width:"83.33333333%",float:"left","text-align":"center"}),a.find(".info-panel .slide-title").css({"padding-left":"30px"}))}()}function g(e){switch(d.player){case"jwplayer":l.jwPlayerInst.seek(e);break;case"html5":var n=a.find(".chameleon-html5-video").get(0);n.currentTime=e,n.play();break;case"youtube":l.ytPlayer.seekTo(e);break;default:throw new Error(d.player+" is not supported")}}function b(e){e=parseInt(e)+1;var n=$('.current-slide .slide-image[data-index="'+e+'"]').parent().parent();$(".carousel-item.active").removeClass("active"),n.addClass("active")}function y(e){var n=e.split(":");return parseInt(60*n[0]*60)+parseInt(60*n[1])+parseInt(n[2])}function j(e){if(e>=y(l.chameleonContext.slides[l.chameleonContext.slides.length-1].time))l.chameleonContext.slides.length>d.numOfCarouselSlide&&b(l.chameleonContext.slides.length-1),S(l.chameleonContext.slides.length-1),P(l.chameleonContext.slides.length-1);else for(var n=0,t=1;n<l.chameleonContext.slides.length;n++,t++)e>=y(l.chameleonContext.slides[n].time)&&e<y(l.chameleonContext.slides[t].time)&&(l.chameleonContext.slides.length>d.numOfCarouselSlide&&(b(n),P(n)),S(n))}function S(e){a.find(".slide-container img").attr("src",l.chameleonContext.slides[e].img),a.find(".slide-container img").attr("title",l.chameleonContext.slides[e].title),a.find(".slide-container img").attr("alt",l.chameleonContext.slides[e].alt)}function P(e){a.find(".chameleon-hightlighted").removeClass("chameleon-hightlighted"),a.find(".info-panel-slide[data-index='"+e+"']").addClass("chameleon-hightlighted")}!function(){if($.isEmptyObject(d.chameleonContext))throw new Error("Chameleon chameleonContext hasn't been defined.");if(a.append(n),a.append(t),a.append(s),a.append(o),a.append(i),d.responsive||a.css("width",d.width).css("height",d.height),"object"==typeof d.chameleonContext&&(l.chameleonContext=d.chameleonContext,C()),"string"==typeof d.chameleonContext){if("json"!=/(?:\.([^.]+))?$/.exec(d.chameleonContext)[1])throw new Error("JSON file required.");$.getJSON(d.chameleonContext,function(e){l.chameleonContext=e}).done(function(){C()})}}()}$.fn[I]=function(e){if("string"==typeof e){var n,t=e,o=Array.prototype.slice.call(arguments,1);return this.each(function(){if(!$.data(this,"plugin_"+I)||"function"!=typeof $.data(this,"plugin_"+I)[t])throw new Error("Method "+t+" does not exist on jQuery."+I);n=$.data(this,"plugin_"+I)[t].apply(this,o)}),void 0!==n?n:this}if("object"==typeof e||!e)return this.each(function(){$.data(this,"plugin_"+I)||$.data(this,"plugin_"+I,new i(this,e))})},$.fn[I].defaults={width:"968px",height:"270px",chameleonContext:{},numOfCarouselSlide:5,responsive:!1,player:"html5"}});
